<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Portal</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0b0d10;
    --glass: rgba(255,255,255,0.04);
    --accent: #00e6d1;
    --accent-2:#ff4da6;
    --muted:#94a3b8;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Arial; background:
    radial-gradient(1200px 600px at 10% 10%, rgba(0,230,209,0.04), transparent),
    radial-gradient(900px 400px at 90% 90%, rgba(255,77,166,0.03), transparent),
    var(--bg); color:#e6eef6; -webkit-font-smoothing:antialiased;
    display:grid; place-items:center; padding:32px;
  }

  /* container (minimal) */
  .card{
    width:min(920px, 96vw);
    display:grid;
    grid-template-columns: 1fr 380px;
    gap:28px;
    align-items:center;
    backdrop-filter: blur(6px) saturate(120%);
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border: 1px solid rgba(255,255,255,0.04);
    padding:34px;
    border-radius:18px;
    box-shadow: 0 10px 50px rgba(2,6,23,0.6);
    position:relative;
    overflow:hidden;
  }

  /* left: hero */
  .hero{
    padding-right:8px;
  }
  .logo{
    display:inline-grid; place-items:center;
    width:56px;height:56px;border-radius:12px;
    background: linear-gradient(135deg, rgba(0,230,209,0.12), rgba(255,77,166,0.06));
    border:1px solid rgba(255,255,255,0.03);
    box-shadow: 0 6px 30px rgba(0,0,0,0.7), inset 0 1px 0 rgba(255,255,255,0.02);
    transform: translateZ(0);
  }
  h1{
    margin:0 0 10px 0; font-weight:600; font-size:28px;
    letter-spacing: -0.02em;
    color: #efffff;
  }
  p.lead{
    margin:0; color:var(--muted); font-size:14px; line-height:1.5;
  }

  /* subtle animated waveform under heading */
  .wave{
    margin-top:18px; height:38px; width:100%; position:relative; overflow:hidden;
  }
  .bar{position:absolute; left:0; right:0; height:100%;}
  .pulse{
    height:100%; width:100%; background:
      linear-gradient(90deg, rgba(0,230,209,0.06), transparent 30%),
      linear-gradient(90deg, rgba(255,77,166,0.03), transparent 40%);
    transform: translateX(-35%);
    animation: sweep 3.8s linear infinite;
    opacity:.9; filter: blur(8px);
  }
  @keyframes sweep { to{transform: translateX(35%)} }

  /* right: admin box */
  .admin{
    display:flex; flex-direction:column; gap:14px;
    padding:20px; border-radius:12px;
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
    border:1px solid rgba(255,255,255,0.03);
  }
  label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
  input[type="text"], input[type="number"], input[type="password"]{
    width:100%; padding:10px 12px; border-radius:8px; border:1px solid rgba(255,255,255,0.04);
    background: rgba(255,255,255,0.02); color: #eaf6f5; outline:none; font-size:14px;
    transition: transform .12s ease, box-shadow .12s ease;
  }
  input:focus{ box-shadow:0 6px 18px rgba(0,230,209,0.06); transform: translateY(-2px); border-color: rgba(0,230,209,0.14) }

  .row{display:flex; gap:8px}
  .small{width:120px}

  button.primary{
    display:inline-flex; align-items:center; justify-content:center; gap:8px;
    background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:#051014;
    border:none; padding:10px 14px; font-weight:600; border-radius:10px; cursor:pointer;
    transition: transform .12s ease, box-shadow .12s ease;
    box-shadow: 0 8px 30px rgba(0,230,209,0.08);
  }
  button.primary:active{ transform: translateY(1px) }
  button.secondary{
    background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.03);
    padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600;
  }

  /* generated link output */
  .output{
    margin-top:8px; display:flex; gap:8px; align-items:center;
    opacity:0; transform: translateY(6px);
    transition: opacity .28s ease, transform .28s ease;
  }
  .output.visible{ opacity:1; transform: translateY(0) }
  .copy{
    display:flex; gap:8px; align-items:center;
    background: rgba(0,0,0,0.35); padding:8px; border-radius:8px;
    border:1px solid rgba(255,255,255,0.03);
    overflow:hidden;
  }
  .copy input{
    background:transparent; border:none; color: #dff; outline:none; width:100%;
    font-size:13px; padding:6px 8px;
  }
  .copy button{ background:var(--accent); color:#022; border:none; padding:8px 10px; border-radius:8px; cursor:pointer; font-weight:700 }

  /* tiny footer */
  .meta{ font-size:12px; color:var(--muted); margin-top:12px }

  /* mobile */
  @media (max-width:880px){
    .card{ grid-template-columns: 1fr; padding:20px; gap:18px; }
    .admin{ order:2 }
  }
</style>
</head>
<body>
  <div class="card" role="region" aria-label="Portal">
    <div class="hero">
      <div class="logo" aria-hidden>
        <!-- simple icon -->
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden>
          <rect x="3" y="3" width="18" height="18" rx="5" fill="url(#g)"/>
          <defs>
            <linearGradient id="g" x1="0" x2="1">
              <stop offset="0" stop-color="#00e6d1"/>
              <stop offset="1" stop-color="#ff4da6"/>
            </linearGradient>
          </defs>
        </svg>
      </div>

      <h1>Private test distribution</h1>
      <p class="lead">A refined staging area for selected testers. Smooth experience, one button download links.</p>

      <div class="wave" aria-hidden>
        <div class="bar pulse"></div>
      </div>

      <div class="meta">Built with care — minimal footprint, maximum polish.</div>
    </div>

    <aside class="admin" aria-label="Admin panel (hidden)">
      <div>
        <label for="f">File name (on VPS <code>/files</code>)</label>
        <input id="f" type="text" placeholder="e.g. myrelease.zip" autocomplete="off" />
      </div>

      <div class="row" style="align-items:center">
        <div>
          <label for="uses">Allowed uses</label>
          <input id="uses" class="small" type="number" min="1" value="1" />
        </div>
        <div style="flex:1">
          <label for="exp">Expires (seconds)</label>
          <input id="exp" type="number" min="60" value="86400" />
        </div>
      </div>

      <div style="display:flex; gap:10px; margin-top:6px">
        <button id="gen" class="primary" title="Generate link">Generate</button>
        <button id="close" class="secondary" title="Close">Close</button>
      </div>

      <div id="out" class="output" aria-live="polite">
        <div class="copy" role="group" aria-label="Generated link">
          <input id="linkField" readonly />
          <button id="copyBtn">Copy</button>
        </div>
      </div>

      <div style="margin-top:8px">
        <label for="adm">Admin unlock</label>
        <input id="adm" type="password" placeholder="Nickname: test  Password: test" />
      </div>
    </aside>
  </div>

<script>
/* ---------- subtle hidden unlock ---------- */
/* Visitors won't see admin until you type "accesgranted" anywhere. */
const SECRET = "accesgranted";
let buf = "";
window.addEventListener("keydown", e => {
  if (e.key.length !== 1) return;
  buf += e.key.toLowerCase();
  if (buf.length > SECRET.length) buf = buf.slice(-SECRET.length);
  if (buf === SECRET) {
    // show admin area (visual reveal)
    document.querySelector('.admin').style.transform = 'none';
    document.getElementById('adm').focus();
    // small visual hint (keeps minimal)
    document.querySelector('.admin').style.display = 'flex';
  }
});

/* ---------- admin behavior ---------- */
const gen = document.getElementById('gen');
const close = document.getElementById('close');
const out = document.getElementById('out');
const linkField = document.getElementById('linkField');
const copyBtn = document.getElementById('copyBtn');
const adm = document.getElementById('adm');

close.addEventListener('click', () => {
  // hide admin gracefully
  document.querySelector('.admin').style.display = 'none';
  buf = "";
});

// basic UI check — admin inputs are protected by the simple admin password (client-only convenience)
function adminAuthOk() {
  // NOTE: client-only convenience. For real protection use server-side auth.
  // This expects the adm field to contain: "test:test" or anything you prefer
  return adm.value.trim() === "test:test" || adm.value.trim() === "test";
}

/* generate link: call your VPS generate endpoint */
gen.addEventListener('click', async () => {
  if (!adminAuthOk()) {
    adm.style.border = '1px solid rgba(255,77,166,0.8)';
    adm.style.boxShadow = '0 6px 20px rgba(255,77,166,0.06)';
    return;
  }
  const filename = document.getElementById('f').value.trim();
  if (!filename) {
    animateError(document.getElementById('f'));
    return;
  }
  gen.disabled = true;
  gen.textContent = 'Generating…';
  try {
    const body = {
      filename,
      uses: Number(document.getElementById('uses').value) || 1,
      expiresInSeconds: Number(document.getElementById('exp').value) || 86400
    };

    // IMPORTANT: Replace 'REPLACE_WITH_SECRET' with your real server secret only if you
    // host this page privately. Do NOT publish your real secret in a public repo.
    const resp = await fetch('http://167.86.123.109/api/generate', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'x-gen-secret': 'REPLACE_WITH_SECRET'
      },
      body: JSON.stringify(body)
    });

    const data = await resp.json();

    if (!resp.ok) throw new Error(data.error || JSON.stringify(data));

    linkField.value = data.link;
    out.classList.add('visible');

    // nice animated feedback
    copyBtn.animate([{transform:'translateY(-6px)'},{transform:'translateY(0)'}], {duration:420, easing:'ease-out'});
  } catch (err) {
    console.error(err);
    alert('Failed to generate link — check server and secret. ' + (err.message || ''));
  } finally {
    gen.disabled = false;
    gen.textContent = 'Generate';
  }
});

/* copy behavior */
copyBtn.addEventListener('click', async () => {
  try {
    await navigator.clipboard.writeText(linkField.value);
    copyBtn.textContent = 'Copied!';
    copyBtn.style.background = '#ff4da6';
    setTimeout(()=>{ copyBtn.textContent='Copy'; copyBtn.style.background=''; }, 1500);
  } catch {
    const sel = linkField;
    sel.select();
    document.execCommand('copy');
    copyBtn.textContent = 'Copied!';
    setTimeout(()=>{ copyBtn.textContent='Copy'; }, 1500);
  }
});

/* little shake on empty */
function animateError(el) {
  el.animate([{transform:'translateX(-6px)'},{transform:'translateX(6px)'},{transform:'translateX(0)'}], {duration:280});
  el.focus();
}
</script>
</body>
</html>
