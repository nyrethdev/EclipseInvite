<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Download</title>
<style>
  :root{--bg:#05060a;--accent:#00e6d1;--muted:#97a6b8}
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0; display:grid; place-items:center; font-family:Inter,system-ui,Arial; background:linear-gradient(180deg,#020204,#07101a); color:#eaf6f5; padding:28px}
  .box{width:min(720px,94vw); text-align:center; padding:32px; border-radius:14px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.03); box-shadow:0 12px 50px rgba(0,0,0,0.6)}
  h2{margin:0 0 10px;font-size:20px}
  p.sub{margin:0 0 18px;color:var(--muted)}
  .status{margin:12px 0 20px; font-weight:600}
  button.dl{background:linear-gradient(90deg,var(--accent),#ff4da6); color:#021214; border:none; padding:12px 18px; border-radius:10px; font-weight:700; cursor:pointer; box-shadow:0 10px 30px rgba(0,230,209,0.06)}
  .muted{color:var(--muted); font-size:13px; margin-top:12px}
</style>
</head>
<body>
  <div class="box" role="main" aria-live="polite">
    <h2>Secure Download</h2>
    <p class="sub">One-click download — link will expire after its allotted uses.</p>
    <div id="payload">
      <div class="status">Verifying…</div>
    </div>
    <div class="muted">If the link fails, contact the owner.</div>
  </div>

<script>
(async function(){
  const params = new URLSearchParams(location.search);
  const token = params.get('token');
  const payload = document.getElementById('payload');
  if(!token){ payload.innerHTML = '<div class="status">No token provided.</div>'; return; }

  try{
    const res = await fetch('http://167.86.123.109/api/validate?token=' + encodeURIComponent(token));
    const data = await res.json();
    if(!res.ok || !data.valid){
      payload.innerHTML = `<div class="status">Link invalid: ${data.reason || data.error || 'unknown'}</div>`;
      return;
    }

    // show download button only
    payload.innerHTML = `<div class="status">File: <strong>${data.file}</strong> • uses left: ${data.usesLeft}</div>
      <div><button id="go" class="dl">Download</button></div>`;

    document.getElementById('go').addEventListener('click', () => {
      // navigate to server download endpoint — server will stream file
      location.href = 'http://167.86.123.109/api/download?token=' + encodeURIComponent(token);
    });

  }catch(err){
    console.error(err);
    payload.innerHTML = '<div class="status">Server error — try again later.</div>';
  }
})();
</script>
</body>
</html>
